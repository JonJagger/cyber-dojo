
<script type="text/javascript"><!--

$(document).ready(function() {

  var id = function() {
    return "<%= @kata.id %>";
  };

  var minuteColumns = function() {
    return $('#minute_columns_checkbox').is(':checked');
  };

  var autoRefresh = function() {
    return $('#auto_refresh_checkbox').is(':checked');
  };

  var dashboardHeartbeat = function() {
    if (autoRefresh()) {
      $.ajax({
        url: '/dashboard/heartbeat',
        data: {
          id: id(),
          minute_columns: minuteColumns(),
          auto_refresh: autoRefresh()
        },
        dataType: "script"
      });
    }
  };

  var refreshDashboard = function() {
    var url = '/dashboard/show/' + id() + '?' +
              'minute_columns=' + minuteColumns() + '&' +
              'auto_refresh=' + autoRefresh();
    window.location = url;
  };

  var seconds = 1000;
  setInterval(dashboardHeartbeat, 10*seconds);

  $('#minute_columns_checkbox')
    .attr('checked', "<%= @minute_columns %>" === "true")
    .click(function() {
      refreshDashboard();
    });

  $('#auto_refresh_checkbox')
    .attr('checked', "<%= @auto_refresh %>" === "true")
    .click(function() {
      refreshDashboard();
    });

});

//--></script>

<table id="controls-container">
  <tr>
    <td>
      <div title="toggles 60-second columns on/off">
        <%= raw t("views.labels.columns") %>
      </div>
    </td>
    <td>
      &nbsp;
    </td>
    <td>
      <input type="checkbox"
             class="regular-checkbox"
             id="minute_columns_checkbox"/>
        <label for="minute_columns_checkbox"></label>
    </td>
  </tr>
  <tr>
    <td>
      <div title="toggle the 10 second auto-refresh on/off">
        <%= raw t('views.labels.auto_refresh') %>
      </div>
    </td>
    <td>
      &nbsp;
    </td>
    <td>
      <input type="checkbox"
             class="regular-checkbox"
             id="auto_refresh_checkbox"/>
        <label for="auto_refresh_checkbox"></label>
    </td>
  </tr>
</table>
